---
title: "Article"
author: "Alyssa Imbert and Etienne Thevenot (ProMetIS consortium)"
date: "`r doc_date()`"

vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  # bibliography: "ProMetIA.bib"
output:
  BiocStyle::html_document:
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: false
---

![](figures/prometis_logo.png)

```{r options, include=FALSE}
knitr::opts_chunk$set(fig.width = 8,
                      fig.height = 8,
                      fig.path = 'figures/article/',
                      echo = FALSE,
                      message = FALSE,
                      warning = FALSE)
```

# Loading the LAT and MX2 data

```{r loading}
mset.ls <- lapply(ProMetIS::genes.vc(),
                  function(gene.c) {
                    gene.mset <- phenomis::reading(file.path(ProMetIS::aggregated_dir.c(gene.c)),
                                                   report.c = "none")
                    gene.mset <- gene.mset[, ProMetIS::sets.vc()]
                  })
names(mset.ls) <- ProMetIS::genes.vc()
```

# Number of samples and features for each dataset

```{r dims, fig.width = 10}
data_dims.mn <- NULL
for (gene.c in ProMetIS::genes.vc()) {
  gene.mset <- mset.ls[[gene.c]]
  gene_dims.mn <- t(sapply(names(gene.mset),
                          function(set.c) {
                            eset <- gene.mset[[set.c]]
                            rev(dim(eset))
                          }))
  colnames(gene_dims.mn) <- paste0(gene.c, "_", colnames(gene_dims.mn))
  data_dims.mn <- cbind(data_dims.mn, gene_dims.mn)
}

data_dims.mn <- data_dims.mn[c("clinics",
                               "proteomics_liver",
                               "metabolomics_liver_c18hyper_pos",
                               "metabolomics_liver_hilic_neg",
                               "proteomics_plasma",
                               "metabolomics_plasma_c18hyper_pos",
                               "metabolomics_plasma_hilic_neg",
                               "metabolomics_plasma_c18acqui_pos",
                               "metabolomics_plasma_c18acqui_neg"), ]

rownames(data_dims.mn) <- c("clinics",
                            "liver_proteomics",
                            "liver_metabo_c18hyper.pos",
                            "liver_metabo_hilic.neg",
                            "plasma_proteomics",
                            "plasma_metabo_c18hyper.pos",
                            "plasma_metabo_hilic.neg",
                            "plasma_metabo_c18acqui.pos",
                            "plasma_metabo_c18acqui.neg")

p <- phenomis::gg_barplot(data_dims.mn,
                          bar_just.n = 0,
                          cex_bar.i = 5,
                          cex_axis.i = 14,
                          palette.vc = c(LAT_Samples = as.character(ProMetIS::palette.vc(light.l = TRUE)["LAT"]),
                                         LAT_Features = as.character(ProMetIS::palette.vc()["LAT"]),
                                         MX2_Samples = as.character(ProMetIS::palette.vc(light.l = TRUE)["MX2"]),
                                         MX2_Features = as.character(ProMetIS::palette.vc()["MX2"])),
                          figure.c = "none")
p <- p + ggplot2::scale_y_continuous(trans = "log10", limits = c(1, NA),
                                     expand = ggplot2::expansion(add = c(0, 1)))
print(p)
```

# Clinical features
```{r clinics}
clinics.eset <- mset.ls[["LAT"]][["clinics"]]

# for (figure.c in c("none",
#                    "figures/article/clinics_pie.pdf")) {
  phenomis::gg_pie(Biobase::fData(clinics.eset), y.c = "category",
                   title.c = "Clinical variables",
                   geom_text.ls = list(lab.i = 4, legend_text.i = 8, title.i = 18),
                   label.c = "value")
                   # , figure.c = figure.c)
# }
```

